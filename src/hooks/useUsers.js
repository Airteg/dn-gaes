import { useQuery } from "@tanstack/react-query";
import fetchWithAuth from "@/utils/fetchWithAuth";
// üîπ –Ü–º–ø–æ—Ä—Ç–∏:
// useQuery ‚Äî –æ—Å–Ω–æ–≤–Ω–∏–π —Ö—É–∫ –∑ react-query, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –∫–µ—à, —Ñ–µ—Ç—á–∏–Ω–≥, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è.
// fetchWithAuth ‚Äî —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ HTTP-–∑–∞–ø–∏—Ç—É –∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é (Bearer-token).

// üîπ –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ —Ö—É–∫:
// –ü—Ä–∏–π–º–∞—î –æ–±'—î–∫—Ç –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
// filter: –ø–æ—à—É–∫ –ø–æ —ñ–º–µ–Ω—ñ/–µ–º–µ–π–ª—É
// showDeleted: –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–∏—Ö?
// page: –Ω–æ–º–µ—Ä —Å—Ç–æ—Ä—ñ–Ω–∫–∏
export const useUsers = ({ filter = "", showDeleted = false, page = 1 }) =>
  useQuery({
    // !üîπ queryKey:
    // –ö–ª—é—á, –∑–∞ —è–∫–∏–º react-query –∫–µ—à—É—î –¥–∞–Ω—ñ.
    // –Ø–∫—â–æ filter, page, showDeleted –∑–º—ñ–Ω—è—Ç—å—Å—è ‚Äî –∑–∞–ø–∏—Ç –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ.
    // ["users", {...}] ‚Äî –¥–æ–ø–æ–º–∞–≥–∞—î react-query –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–µ—à—É–≤–∞—Ç–∏ —ñ
    // –ø–µ—Ä–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Ç–æ–¥—ñ, –∫–æ–ª–∏ —î –∑–º—ñ–Ω–∏.
    queryKey: ["users", { filter, showDeleted, page }],
    // !üîπ queryFn:
    // –§—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –≤–∏–∫–ª–∏–∫–∞—î fetchWithAuth.
    // –§–æ—Ä–º—É—î URL –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
    // encodeURIComponent(filter) ‚Äî –Ω–∞ –≤–∏–ø–∞–¥–æ–∫, —è–∫—â–æ –≤ filter —î –ø—Ä–æ–±—ñ–ª–∏, —Å–∏–º–≤–æ–ª–∏ —Ç–æ—â–æ.
    queryFn: async () => {
      return await fetchWithAuth(
        `/api/admin/users?filter=${encodeURIComponent(filter)}&showDeleted=${showDeleted}&page=${page}`,
      );
    },
    // !üîπ staleTime:
    // –ü—Ä–æ—Ç—è–≥–æ–º —Ü—å–æ–≥–æ —á–∞—Å—É react-query –Ω–µ –±—É–¥–µ —Ñ–µ—Ç—á–∏—Ç–∏ –∑–∞–Ω–æ–≤–æ, –±–æ –≤–≤–∞–∂–∞—î –¥–∞–Ω—ñ "—Å–≤—ñ–∂–∏–º–∏".
    // –Ø–∫—â–æ —Ç–∏ –≤—ñ–¥–∫—Ä–∏—î—à —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑–Ω–æ–≤—É –¥–æ 60 —Å–µ–∫ ‚Äî –±—É–¥–µ –º–∏—Ç—Ç—î–≤–∏–π –ø–æ–∫–∞–∑ –∑ –∫–µ—à—É.
    staleTime: 1000 * 60, // 1 —Ö–≤–∏–ª–∏–Ω–∞ –∫–µ—à—É
    // !     retry:
    // –Ø–∫—â–æ false, react-query –Ω–µ –ø–æ–≤—Ç–æ—Ä—é—î –∑–∞–ø–∏—Ç –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ.
    // –ö–æ—Ä–∏—Å–Ω–æ, —è–∫—â–æ –æ—á—ñ–∫—É—î—à, —â–æ 403/401 ‚Äî —Ü–µ –Ω–µ —Ç–∏–º—á–∞—Å–æ–≤–∞ –ø—Ä–æ–±–ª–µ–º–∞ (—Ç–æ–±—Ç–æ, —é–∑–µ—Ä –Ω–µ –º–∞—î –¥–æ—Å—Ç—É–ø—É).
    retry: false, // –Ω–µ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ –ø—Ä–∏ 401/403
  });
// üì¶ –†–µ–∑—É–ª—å—Ç–∞—Ç:
// const { data, isLoading, error } = useUsers({ ... });
// data: { users: [...], total: N }
// isLoading: true/false (—Å—Ç–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)
// error: —è–∫—â–æ —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫
// üîÅ –í—Å–µ –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ: –∫–µ—à, –ø–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è, —Ä–µ—Ñ–µ—Ç—á.
